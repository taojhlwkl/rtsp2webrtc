<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>机房视频安防监控系统</title>
	<link type="text/css" rel="stylesheet" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" href="css/style2019-10-18.css" />
	<script type="text/javascript" src="js/jqueryv3.3.1/jquery.js"></script>
	<style type="text/css">			
		/*  */
	</style>
</head>
<body>
	<div id="container" class="container">
		<div class="north">
			<img class="logo" src="img/logo.png" alt=""/>
			<div class="banner">机房视频安防监控系统</div>
			<ul class="form-control">
				<li style="width: 240px;">
					<input id="search-text" type="text" placeholder="上海外高桥监控机房" />
					<button id="search" class="btn btn-primary">搜索</button>
				</li>
				<li><button id="start" class="btn btn-primary">启动</button></li>
				<li><button id="pause2continue" class="btn btn-primary">暂停</button></li>
				<li><button id="reset" class="btn btn-primary">重置</button></li>
			</ul>
		</div>
		<div class="pictures">
			<div class="left">
				<div class="picture-title">					
					<span>2d监控页面</span>
					<img id="btn-2d-to-big" src="img/icon-fullscreen.png" class="toggle" alt=""/>
				</div>
				<div id="picture-frame-2d-normal" class="picture-frame-2d-normal">
					<img id="picture-2d-normal" src="img/picture2d-1.jpg" width="100%" />		 <!-- 背景 -->			
					<img id="point1" class="point" src="img/bright.png" alt=""  />
					<img id="point2" class="point" src="img/bright.png" alt=""  />
					<img id="point3" class="point" src="img/bright.png" alt=""  />
					<img id="point4" class="point" src="img/bright.png" alt=""  />
					<img id="point5" class="point" src="img/bright.png" alt=""  />								
				</div>
			</div>
			<div class="right">
				<div class="picture-title">					
					<span>3d监控页面</span>
					<img id="btn-3d-to-big" src="img/icon-fullscreen.png" alt="" class="toggle"/>
				</div>
				<div id="picture-frame-3d-normal" class="picture-frame-3d-normal">					
                    <img src="img/picture3d-2.jpg" width="100%;" />
                    
                    <img id="person1" class="person" alt="" src="img/person1_1.png"/>
                    <img id="foot1_1" class="foot foot1"  alt="" src="img/1_1.png" />
                    <img id="foot1_2" class="foot foot2"  alt="" src="img/1_2.png" />
                    <img id="foot1_3" class="foot foot3"  alt="" src="img/1_3.png" />
                    <img id="foot1_4" class="foot foot4"  alt="" src="img/1_4.png" />                
                    
					<img id="person2" class="person" alt="" src="img/person2_1.png"/>
                    <img id="foot2_1" class="foot foot1"  alt="" src="img/1_1.png" />
                    <img id="foot2_2" class="foot foot2"  alt="" src="img/1_2.png" />
                    <img id="foot2_3" class="foot foot3"  alt="" src="img/1_3.png" />
                    <img id="foot2_4" class="foot foot4"  alt="" src="img/1_4.png" />

                    <img id="person3" class="person" alt="" src="img/person2_1.png"/>
                    <img id="foot3_1" class="foot foot1"  alt="" src="img/1_1.png" />
                    <img id="foot3_2" class="foot foot2"  alt="" src="img/1_2.png" />
                    <img id="foot3_3" class="foot foot3"  alt="" src="img/1_3.png" />
                    <img id="foot3_4" class="foot foot4"  alt="" src="img/1_4.png" />

                    <img id="person4" class="person" alt="" src="img/person2_1.png"/>
                    <img id="foot4_1" class="foot foot1"  alt="" src="img/1_1.png" />
                    <img id="foot4_2" class="foot foot2"  alt="" src="img/1_2.png" />
                    <img id="foot4_3" class="foot foot3"  alt="" src="img/1_3.png" />
                    <img id="foot4_4" class="foot foot4"  alt="" src="img/1_4.png" />

                    <img id="person5" class="person" alt="" src="img/person2_1.png"/>
                    <img id="foot5_1" class="foot foot5"  alt="" src="img/1_1.png" />
                    <img id="foot5_2" class="foot foot5"  alt="" src="img/1_2.png" />
                    <img id="foot5_3" class="foot foot5"  alt="" src="img/1_3.png" />
                    <img id="foot5_4" class="foot foot5"  alt="" src="img/1_4.png" />
                    
				</div>	
			</div>
		</div>
		<div class="videos">			
			<div class="video-list-frame">
				<p class="title">
					<span>监控摄像头</span>
					<img id="btn-pop-tips" src="img/icon-pop-tips.png" alt="" />
				</p>
				<div class="video-list">
					<div class="video-cell">				
						<p class="bg">&nbsp;</p>	
						<p class="title">1号</p>										
						<video class="video-ins" src="videos/20191008_01.mp4" width="224" controls></video>
															 
					</div>
					<div class="video-cell">				
						<p class="bg">&nbsp;</p>	
						<p class="title">2号</p>										
						<video class="video-ins" src="videos/20191008_02.mp4" width="224" controls></video>
					</div>
					<div class="video-cell">				
						<p class="bg">&nbsp;</p>	
						<p class="title">3号</p>										
						<video class="video-ins" src="videos/20191008_03.mp4" width="224" controls></video>
					</div>
					<div class="video-cell">				
						<p class="bg">&nbsp;</p>	
						<p class="title">4号</p>										
						<video class="video-ins" src="videos/20191008_04.mp4" width="224" controls></video>
					</div>
					<div class="video-cell">				
						<p class="bg">&nbsp;</p>	
						<p class="title">5号</p>										
						<video class="video-ins" src="videos/20191008_05.mp4" width="224" controls></video>
					</div>											
				</div>	
			</div>	
		</div><!--end of videos-->
	</div><!--end of container-->

	<!-- 模态框 -->
	<div id="modal" class="passive"></div>
	
	<!-- 2d页面放大框 -->
	<div id="big-screen-2d-win" class="pop-win passive">
		<p class="title">
			<span>2d监控页面</span>	
			<img id="btn-2d-to-normal" class="btn-toggle" src="img/icons/close_white.png" alt="" >
		</p>
		<div id="picture-frame-2d-big" class="picture-frame-big">
			<img id="picture-2d-big" src="img/picture2d-1.jpg" width="100%" />         			
            <img id="point1" class="point" src="img/bright.png" alt=""  />
            <img id="point2" class="point" src="img/bright.png" alt=""  />
            <img id="point3" class="point" src="img/bright.png" alt=""  />
            <img id="point4" class="point" src="img/bright.png" alt=""  />
            <img id="point5" class="point" src="img/bright.png" alt=""  />
		</div>
	</div>

	<!-- 3d页面放大框 -->
	<div id="big-screen-3d-win" class="pop-win passive">
		<p class="title">
			<span>3d监控页面</span>	
			<img id="btn-3d-to-normal" class="btn-toggle" src="img/icons/close_white.png" alt="" >
		</p>
		<div id="picture-frame-3d-big" class="picture-frame-big">
			<img id="picture-3d-big" src="img/picture3d-2.jpg" width="100%" />
                      
            <img id="person1" class="person" alt="" src="img/person1_1.png"/>
            <img id="foot1_1" class="foot foot1"  alt="" src="img/1_1.png" />
            <img id="foot1_2" class="foot foot2"  alt="" src="img/1_2.png" />
            <img id="foot1_3" class="foot foot3"  alt="" src="img/1_3.png" />
            <img id="foot1_4" class="foot foot4"  alt="" src="img/1_4.png" />                
            
            <img id="person2" class="person" alt="" src="img/person2_1.png"/>
            <img id="foot2_1" class="foot foot1"  alt="" src="img/1_1.png" />
            <img id="foot2_2" class="foot foot2"  alt="" src="img/1_2.png" />
            <img id="foot2_3" class="foot foot3"  alt="" src="img/1_3.png" />
            <img id="foot2_4" class="foot foot4"  alt="" src="img/1_4.png" />

            <img id="person3" class="person" alt="" src="img/person2_1.png"/>
            <img id="foot3_1" class="foot foot1"  alt="" src="img/1_1.png" />
            <img id="foot3_2" class="foot foot2"  alt="" src="img/1_2.png" />
            <img id="foot3_3" class="foot foot3"  alt="" src="img/1_3.png" />
            <img id="foot3_4" class="foot foot4"  alt="" src="img/1_4.png" />

            <img id="person4" class="person" alt="" src="img/person2_1.png"/>
            <img id="foot4_1" class="foot foot1"  alt="" src="img/1_1.png" />
            <img id="foot4_2" class="foot foot2"  alt="" src="img/1_2.png" />
            <img id="foot4_3" class="foot foot3"  alt="" src="img/1_3.png" />
            <img id="foot4_4" class="foot foot4"  alt="" src="img/1_4.png" />

            <img id="person5" class="person" alt="" src="img/person2_1.png"/>
            <img id="foot5_1" class="foot foot5"  alt="" src="img/1_1.png" />
            <img id="foot5_2" class="foot foot5"  alt="" src="img/1_2.png" />
            <img id="foot5_3" class="foot foot5"  alt="" src="img/1_3.png" />
            <img id="foot5_4" class="foot foot5"  alt="" src="img/1_4.png" />


		</div>
	</div>
	<!-- camera position -->
	<div id="camera-position" class="pop-win passive">
		<p class="title">
			<span>摄像头方位图</span>	
			<img id="btn-close-camera-position" class="btn-toggle" src="img/icons/close_white.png" alt="" >
		</p>
		<img src="img/explain.jpg" alt="" width="100%" />
	</div>
</body>
<script type="text/javascript">

	var serverIpAddress="192.168.0.103";
	var index=0;
	var totalFrame=0;
	var handle=0;
	var bigIntervalHandle=0;
	var videos=$(".video-ins");
	var isPause=true;
	var originalData={};

	$(function(){

		//TODO:初始化页面	
		initPage();

		//TODO:启动
		$("#start").on("click",start);

		//TODO:暂停和继续
		$("#pause2continue").on("click",pause2continue);

		//TODO:重置
		$("#reset").on("click",reset);

		//TODO:2d显示放大效果
		$("#btn-2d-to-big").on("click",toBig2d);	

		//TODO:2D返回
		$("#btn-2d-to-normal").on("click",toNormal2d);
		
		//3d显示放大效果
		$("#btn-3d-to-big").on("click",toBig3d);
		
		//TODO:3D返回
		$("#btn-3d-to-normal").on("click",toNormal3d);

		//TODO:pop tips
		$("#btn-pop-tips").on("click",popTips);
		
		//TODO:close tips
		$("#btn-close-camera-position").on("click",closeTips);

	});
	//TODO:初始化页面
	function initPage(){				
		//$.get("http://"+serverIpAddress+":8888/my/getVideoAndTime?computerRoomId=2").done(function(da,sta,xhr){
		$.get("data/getVideoAndTime2019-10-18-single.json").done(function(da,sta,xhr){	
            //console.log(da);return;
			if(da.state){
				originalData=da.data;
				totalFrame=da.data.length;
			}else{
				alert("error");
			}
		});
	}
	//TODO:启动
	function start(){		
		var picture2dNormal=$("#picture-2d-normal");            //常规状态下2d图片的大小
		var ratio=1920/picture2dNormal.width();                 //计算一个比例即可，3d的图片大小是一样的
		window.clearInterval(handle);                           //不管有没有都可以清除一下
        var temp;
        var points=$("#picture-frame-2d-normal .point");
        var persons=$("#picture-frame-3d-normal .person");
        var foot1s=$("#picture-frame-3d-normal .foot1");
        var foot2s=$("#picture-frame-3d-normal .foot2");
        var foot3s=$("#picture-frame-3d-normal .foot3");
        var foot4s=$("#picture-frame-3d-normal .foot4");
		handle=setInterval(function(){			
            temp=originalData[index];
            temp.videolist.forEach(function(val,ind,arr){
                if(val.id>0){
                    points.eq(ind).css({
                        left:val.pos_x/ratio,
                        top:val.pos_y/ratio
                    }).show();                
                    persons.eq(ind).css({
                        left:val.pos_x/ratio,
                        top:val.pos_y/ratio
                    }).attr("src","img/person"+(ind+1)+"_"+val.image_person+".png").show();                   
                    if(originalData[index-25]){
                        foot1s.eq(ind).css({
                            left:originalData[index-25].videolist[ind].pos_x/ratio,
                            top:originalData[index-25].videolist[ind].pos_y/ratio
                        }).attr("src","img/"+originalData[index-25].videolist[ind].image_foot+"_1"+".png").show();
                    }
                    if(originalData[index-50]){
                        foot2s.eq(ind).css({
                            left:originalData[index-50].videolist[ind].pos_x/ratio,
                            top:originalData[index-50].videolist[ind].pos_y/ratio
                        }).attr("src","img/"+originalData[index-50].videolist[ind].image_foot+"_2"+".png").show();
                    } 
                    if(originalData[index-75]){
                        foot3s.eq(ind).css({
                            left:originalData[index-75].videolist[ind].pos_x/ratio,
                            top:originalData[index-75].videolist[ind].pos_y/ratio
                        }).attr("src","img/"+originalData[index-75].videolist[ind].image_foot+"_3"+".png").show();
                    }
                    if(originalData[index-100]){
                        foot4s.eq(ind).css({
                            left:originalData[index-100].videolist[ind].pos_x/ratio,
                            top:originalData[index-100].videolist[ind].pos_y/ratio
                        }).attr("src","img/"+originalData[index-100].videolist[ind].image_foot+"_4"+".png").show();
                    }
                }else{
                    points.eq(ind).hide();                  
                    persons.eq(ind).hide();
                    foot1s.eq(ind).hide();
                    foot2s.eq(ind).hide();
                    foot3s.eq(ind).hide();
                    foot4s.eq(ind).hide();
                }
            });
            if(index>totalFrame-2){
                window.clearInterval(handle);
                window.clearInterval(bigIntervalHandle);
                index=0;
                points.hide();
                persons.hide();
                foot1s.hide();
                foot2s.hide();
                foot3s.hide();
                foot4s.hide();				
			}
			index++;
		},40);
		//播放所有视频
		videos.each(function(index,item){						
			item.play();
		});
	}
	//TODO:停止
	function pause2continue(){
		if(isPause){
            window.clearInterval(handle);         
			videos.each(function(index,item){						
				item.pause();
			});
			$(this).text("继续");
			isPause=false;			
		}else{
			start();
			$(this).text("暂停");
			isPause=true;
		}
	}
	//TODO:重置
	function reset(){
		index=0;
        window.clearInterval(handle);
        window.clearInterval(bigIntervalHandle);
		//$("#picture-frame-2d-normal .point").hide();
		//$("#picture-frame-3d-normal .person").hide();
		//$("#picture-frame-3d-normal .foot").hide();
		//reload所有视频
		videos.each(function(index,item){						
			item.load();
		});
	}
	//TODO:2D放大
	function toBig2d(){
		window.clearInterval(bigIntervalHandle);      //清除
		$("#modal").show();
		$("#big-screen-2d-win").show();               //先显示内容
		var picture2dBig=$("#picture-2d-big");		
        var bigRatio=1920/picture2dBig.width();	
        var temp;	
        var points=$("#picture-frame-2d-big .point");	
		bigIntervalHandle=window.setInterval(function(){	
            temp=originalData[index];
            temp.videolist.forEach(function(val,ind,arr){
                if(val.id>0){
                    points.eq(ind).css({
                        left:val.pos_x/bigRatio,
                        top:val.pos_y/bigRatio
                    }).show();                                   
                }else{
                    points.eq(ind).hide(); 
                }
            });
		},40);
	}
	//TODO:2D返回
	function toNormal2d(){
		$(this).parent().parent().hide();
		$("#modal").hide();
		window.clearInterval(bigIntervalHandle);   //清除		
	}
	//TODO:3D放大
	function toBig3d(){
		window.clearInterval(bigIntervalHandle);   //清除						
		$("#modal").show();
		$("#big-screen-3d-win").show();
		var picture2dBig=$("#picture-3d-big");
        var bigRatio=1920/picture2dBig.width();
        
        var persons=$("#picture-frame-3d-big .person");
        var foot1s=$("#picture-frame-3d-big .foot1");
        var foot2s=$("#picture-frame-3d-big .foot2");
        var foot3s=$("#picture-frame-3d-big .foot3");
        var foot4s=$("#picture-frame-3d-big .foot4");

      
        // var persons=$("#picture-frame-3d-normal .person");
        // var foot1s=$("#picture-frame-3d-normal .foot1");
        // var foot2s=$("#picture-frame-3d-normal .foot2");
        // var foot3s=$("#picture-frame-3d-normal .foot3");
        // var foot4s=$("#picture-frame-3d-normal .foot4");


        var temp;

        bigIntervalHandle=window.setInterval(function(){				
			temp=originalData[index];
            temp.videolist.forEach(function(val,ind,arr){
                if(val.id>0){                 
                    persons.eq(ind).css({
                        left:val.pos_x/bigRatio,
                        top:val.pos_y/bigRatio
                    }).attr("src","img/person"+(ind+1)+"_"+val.image_person+".png").show();                   
                    if(originalData[index-25]){
                        foot1s.eq(ind).css({
                            left:originalData[index-25].videolist[ind].pos_x/bigRatio,
                            top:originalData[index-25].videolist[ind].pos_y/bigRatio
                        }).attr("src","img/"+originalData[index-25].videolist[ind].image_foot+"_1"+".png").show();
                    }
                    if(originalData[index-50]){
                        foot2s.eq(ind).css({
                            left:originalData[index-50].videolist[ind].pos_x/bigRatio,
                            top:originalData[index-50].videolist[ind].pos_y/bigRatio
                        }).attr("src","img/"+originalData[index-50].videolist[ind].image_foot+"_2"+".png").show();
                    } 
                    if(originalData[index-75]){
                        foot3s.eq(ind).css({
                            left:originalData[index-75].videolist[ind].pos_x/bigRatio,
                            top:originalData[index-75].videolist[ind].pos_y/bigRatio
                        }).attr("src","img/"+originalData[index-75].videolist[ind].image_foot+"_3"+".png").show();
                    }
                    if(originalData[index-100]){
                        foot4s.eq(ind).css({
                            left:originalData[index-100].videolist[ind].pos_x/bigRatio,
                            top:originalData[index-100].videolist[ind].pos_y/bigRatio
                        }).attr("src","img/"+originalData[index-100].videolist[ind].image_foot+"_4"+".png").show();
                    }
                }else{                                
                    persons.eq(ind).hide();
                    foot1s.eq(ind).hide();
                    foot2s.eq(ind).hide();
                    foot3s.eq(ind).hide();
                    foot4s.eq(ind).hide();
                }
                if(index>totalFrame-2){                  
                    persons.hide();
                    foot1s.hide();
                    foot2s.hide();
                    foot3s.hide();
                    foot4s.hide();				
                }
            });
		},40);	
	}
	//TODO:3D返回
	function toNormal3d(){
		$(this).parent().parent().hide();
		$("#modal").hide();
		window.clearInterval(bigIntervalHandle);   //清除	
	}
	//TODO:pop tips
	function popTips(){
		$("#modal").show();
		$("#camera-position").show();
	}
	//TODO:pop tips
	function closeTips(){
		$("#modal").hide();
		$("#camera-position").hide();
	}
</script>
</html>
